# macOSå®‰å“æ¨¡æ‹Ÿå™¨è‡ªåŠ¨åŒ–æ§åˆ¶å¹³å° - åŒèŠ±é¡ºæŠ€æœ¯åˆ†æ

**ä»»åŠ¡ ID**: T019
**ä¼˜å…ˆçº§**: P1
**åˆ›å»ºæ—¶é—´**: 2026-02-02 23:45
**çŠ¶æ€**: ğŸ”¸ è°ƒç ”å®Œæˆï¼Œå¾…å®‰è£…ç¯å¢ƒ
**æ–‡æ¡£æ›´æ–°**: 2026-02-03 14:25

---

## ğŸ“Š è°ƒç ”ç»“è®ºï¼ˆ2026-02-03 æ›´æ–°ï¼‰

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æ¥å£ç±»å‹ | Apple Silicon | æ¨èåœºæ™¯ |
|------|----------|---------------|----------|
| **A: Android Studio AVD** | ADB + Console/Telnet + gRPC | âœ… åŸç”Ÿ ARM64 | **é¦–é€‰** - å¼€å‘è°ƒè¯•ã€CIæµæ°´çº¿ |
| **B: Genymotion** | ADB + CLI + REST | âš ï¸ éœ€ARM64è½¬æ¢å™¨ | ä¼ä¸šçº§æµ‹è¯•é›†ç¾¤ |
| **C: BlueStacks** | ADB (å—é™) | âŒ å·®/å®éªŒæ€§ | ä»…æ‰‹æ¸¸æŒ‚æœº |
| **D: NoxPlayer** | ADB ç«¯å£æ˜ å°„ | âŒ ä¸å…¼å®¹ | ä¸æ¨è |

### è¯„ä¼°ç»´åº¦

1. **æ¥å£æš´éœ²èƒ½åŠ›**
   - ADB: Shellæ‰§è¡Œã€æ–‡ä»¶ä¼ è¾“ã€æ—¥å¿—è·å–
   - Console/Telnet: ç¡¬ä»¶å±‚æ§åˆ¶ï¼ˆGPSã€ç”µæ± ã€ç½‘ç»œï¼‰
   - REST API: äº‘ç«¯å®ä¾‹ç®¡ç†
   - Appium: UIäº¤äº’æ¨¡æ‹Ÿï¼ˆç‚¹å‡»/æ»‘åŠ¨ï¼‰

2. **Apple Silicon å…¼å®¹æ€§**
   - å¿…é¡»é€‰æ‹©æ”¯æŒ `android-arm64` é•œåƒçš„æ–¹æ¡ˆ
   - Rosetta è½¬è¯‘ä¼šå¯¼è‡´ä¸¥é‡æ€§èƒ½æŸè€—

3. **æ§åˆ¶ç²’åº¦**
   - åº”ç”¨å±‚: ADB å®‰è£…/å¸è½½
   - ç¡¬ä»¶å±‚: æ¨¡æ‹Ÿä¼ æ„Ÿå™¨ã€ç½‘ç»œæ³¨å…¥ã€æŒ‡çº¹æ¨¡æ‹Ÿ

4. **CI å‹å¥½åº¦**
   - æ— å¤´æ¨¡å¼ (Headless) æ”¯æŒ
   - å¿«ç…§è¿˜åŸèƒ½åŠ›
   - ç«¯å£åŠ¨æ€ç®¡ç† (5554 + JOB_ID*2)

### æ¨èæ–¹æ¡ˆï¼šAndroid å®˜æ–¹æ¨¡æ‹Ÿå™¨ (AVD)

**ç†ç”±**ï¼š
- âœ… Google å®˜æ–¹é•¿æœŸæ”¯æŒ
- âœ… å…è´¹ï¼Œæ¥å£æ–‡æ¡£æœ€å®Œæ•´
- âœ… macOS ARM64 åŸç”Ÿæ€§èƒ½
- âœ… æœ€ä¸°å¯Œæ§åˆ¶æ¥å£ (ADB + Console + gRPC)

---

## æ ¸å¿ƒç›®æ ‡

```
å®‰å“æ¨¡æ‹Ÿå™¨ â†’ åŒèŠ±é¡º â†’ æˆªå›¾ â†’ VLM åˆ†ææŠ€æœ¯ä¿¡å·
```

**å…³é”®è¦æ±‚**: å®ç° MCP Serverï¼Œè®© AI Agent èƒ½è‡ªæˆ‘æ“ä½œ

---

## æ ¸å¿ƒæµç¨‹

```
1. å¯åŠ¨å®‰å“æ¨¡æ‹Ÿå™¨ (AVD)
2. å®‰è£…/æ‰“å¼€åŒèŠ±é¡º app
3. æœç´¢è‚¡ç¥¨ (å¦‚ 688011 æ˜Ÿç¯ç§‘æŠ€)
4. è¿›å…¥åˆ†æ—¶/Kçº¿é¡µé¢
5. æˆªå›¾
6. ç”¨ VLM åˆ†æå›¾ç‰‡
7. è¾“å‡ºæŠ€æœ¯ä¿¡å·
```

## MCP Server æ¥å£è®¾è®¡

```python
# android_emulator_mcp/server.py

from mcp.server import Server
from mcp.types import Tool

app = Server("android-emulator")

@app.tool()
async def start_emulator(avd_name: str = "Pixel_6_API_33") -> str:
    """å¯åŠ¨å®‰å“æ¨¡æ‹Ÿå™¨"""
    pass

@app.tool()
async def install_app(apk_path: str) -> str:
    """å®‰è£… APK åˆ°æ¨¡æ‹Ÿå™¨"""
    pass

@app.tool()
async def open_app(package_name: str) -> str:
    """æ‰“å¼€æŒ‡å®š App"""
    pass

@app.tool()
async def search_stock(stock_code: str) -> str:
    """åœ¨åŒèŠ±é¡ºä¸­æœç´¢è‚¡ç¥¨"""
    pass

@app.tool()
async def navigate_to_page(page: str) -> str:
    """å¯¼èˆªåˆ°æŒ‡å®šé¡µé¢ (åˆ†æ—¶/Kçº¿/è¡Œæƒ…)"""
    pass

@app.tool()
async def take_screenshot(output_path: str) -> str:
    """æˆªå›¾å¹¶ä¿å­˜"""
    pass

@app.tool()
async def analyze_chart_with_vlm(image_path: str) -> dict:
    """ç”¨ VLM åˆ†æå›¾ç‰‡ä¸­çš„æŠ€æœ¯ä¿¡å·"""
    pass

@app.tool()
async def stop_emulator() -> str:
    """åœæ­¢æ¨¡æ‹Ÿå™¨"""
    pass
```

---

## ğŸ”§ AVD å®‰è£…ä¸å¯åŠ¨å‘½ä»¤

### ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿ ANDROID_HOME ç¯å¢ƒå˜é‡
export ANDROID_HOME="/Users/$USER/Library/Android/sdk"

# æ¨èä¸‹è½½ ARM64 é•œåƒ
avdmanager create avd -n Pixel_6_API_33 -k "system-images;android-33;google_apis;arm64-v8a"
```

### å¸¸ç”¨å‘½ä»¤

```bash
# åˆ—å‡ºå¯ç”¨è®¾å¤‡
emulator -list-avds

# æ— å¤´æ¨¡å¼å¯åŠ¨ (é€‚åˆ CI)
emulator -avd Pixel_6_API_33 -no-window -no-audio &

# ADB è¿æ¥
adb connect localhost:5555

# ADB åŸºæœ¬æ“ä½œ
adb devices
adb install app.apk
adb shell am start -n com.hexin.plat/.MainActivity
adb shell screencap -p /sdcard/screen.png
adb pull /sdcard/screen.png /tmp/
```

### Console/Telnet æ§åˆ¶

```bash
# è¿æ¥ Console
telnet localhost 5554

# å¸¸ç”¨æŒ‡ä»¤
# ä¿®æ”¹ GPS
geo fix 114.06 22.62
# æ¨¡æ‹Ÿç”µæºçŠ¶æ€
power status full
# æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
network delay 500
# åœæ­¢æ¨¡æ‹Ÿå™¨
kill
```

---

## å¼€å‘æ¸…å•

### é˜¶æ®µ 1: ç¯å¢ƒå‡†å¤‡ (é¢„è®¡ 2 å°æ—¶)

- [ ] 1.1 å®‰è£… Android Studio + AVD
- [ ] 1.2 ä¸‹è½½ ARM64 é•œåƒ (`system-images;android-33;google_apis;arm64-v8a`)
- [ ] 1.3 å®‰è£…åŒèŠ±é¡º APK (`adb install`)
- [ ] 1.4 éªŒè¯ ADB è¿æ¥ (`adb devices`)
- [ ] 1.5 éªŒè¯æ— å¤´æ¨¡å¼å¯åŠ¨ (`emulator -avd ... -no-window`)
- [ ] 1.6 æµ‹è¯• Console/Telnet è¿æ¥ (`telnet localhost 5554`)

### é˜¶æ®µ 2: æ¨¡æ‹Ÿå™¨æ§åˆ¶ MCP å·¥å…· (é¢„è®¡ 3 å°æ—¶)

- [ ] 2.1 start_emulator() - å¯åŠ¨ AVD (æ”¯æŒ Headless)
- [ ] 2.2 stop_emulator() - åœæ­¢ AVD
- [ ] 2.3 get_emulator_status() - æŸ¥è¯¢çŠ¶æ€
- [ ] 2.4 ç«¯å£åŠ¨æ€ç®¡ç† (5554 + JOB_ID*2)

### é˜¶æ®µ 3: App æ§åˆ¶ MCP å·¥å…· (é¢„è®¡ 3 å°æ—¶)

- [ ] 3.1 install_app() - å®‰è£… APK
- [ ] 3.2 open_app() - æ‰“å¼€ App
- [ ] 3.3 close_app() - å…³é—­ App
- [ ] 3.4 list_apps() - åˆ—å‡ºå·²å®‰è£… App

### é˜¶æ®µ 4: åŒèŠ±é¡ºæ“ä½œ MCP å·¥å…· (é¢„è®¡ 3 å°æ—¶)

- [ ] 4.1 search_stock() - æœç´¢è‚¡ç¥¨
- [ ] 4.2 navigate_to() - é¡µé¢å¯¼èˆª
- [ ] 4.3 scroll_page() - é¡µé¢æ»šåŠ¨
- [ ] 4.4 tap_element() - ç‚¹å‡»å…ƒç´ 

### é˜¶æ®µ 5: æˆªå›¾ MCP å·¥å…· (é¢„è®¡ 1 å°æ—¶)

- [ ] 5.1 take_screenshot() - ADB æˆªå›¾
- [ ] 5.2 save_screenshot() - ä¿å­˜å›¾ç‰‡

### é˜¶æ®µ 6: VLM åˆ†æé›†æˆ (é¢„è®¡ 2 å°æ—¶)

- [ ] 6.1 analyze_chart() - è°ƒç”¨ VLM (å¤ç”¨ tech-signal-vlm)
- [ ] 6.2 è§£ææŠ€æœ¯ä¿¡å·ç»“æœ

### é˜¶æ®µ 7: MCP Server æ•´åˆ (é¢„è®¡ 2 å°æ—¶)

- [ ] 7.1 åˆ›å»º MCP Server
- [ ] 7.2 æ³¨å†Œæ‰€æœ‰å·¥å…·
- [ ] 7.3 æµ‹è¯•éªŒè¯

---

## âš ï¸ å¸¸è§å‘ä½ä¸ CI æœ€ä½³å®è·µ

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| mDNS é—®é¢˜ | ADB è‡ªåŠ¨å‘ç°å¤±è´¥ | `adb kill-server && adb start-server` |
| å†·å¯åŠ¨æ…¢ | AVD å¯åŠ¨ 60s+ | ä½¿ç”¨ `-no-snapshot-save` + é¢„ç½®å¿«ç…§ |
| ç«¯å£å†²çª | ç¡¬ç¼–ç  5554 | åŠ¨æ€è®¡ç®—: `PORT = 5554 + (JOB_ID * 2)` |
| å†…å­˜æ³„æ¼ | é•¿æ—¶é—´è¿è¡Œ | å®šæœŸæ¸…ç†æœªå…³é—­çš„æ¨¡æ‹Ÿå™¨ |

---

## ğŸ›¤ï¸ è½åœ°è·¯å¾„é€‰æ‹©

### è·¯å¾„ 1: ç‹¬ç«‹å¼€å‘è€… (æ¨è)
**é…ç½®**: macOS + AVD + ADB Shell è„šæœ¬
**ç†ç”±**: é›¶æˆæœ¬ï¼Œåˆ©ç”¨ Shell è„šæœ¬å®Œæˆå®‰è£…ã€æˆªå›¾ã€Monkey æµ‹è¯•

### è·¯å¾„ 2: è‡ªåŠ¨åŒ–æµ‹è¯•å›¢é˜Ÿ
**é…ç½®**: Appium + AVD (Headless) + Python
**ç†ç”±**: è·¨å¹³å°è„šæœ¬å¤ç”¨ï¼Œå¤æ‚ UI æ–­è¨€

### è·¯å¾„ 3: ä¼ä¸šçº§ CI/CD é›†ç¾¤
**é…ç½®**: Genymotion Cloud æˆ–è‡ªå»º Mac mini é›†ç¾¤
**ç†ç”±**: å•å° Mac è¿è¡Œ >4 æ¨¡æ‹Ÿå™¨ä¼š I/O ç“¶é¢ˆ

---

## é¢„ä¼°å·¥æ—¶

**æ€»è®¡: 16 å°æ—¶ (2å¤©)**

---

## MCP Server ä½¿ç”¨ç¤ºä¾‹

```python
# AI Agent è°ƒç”¨ç¤ºä¾‹
from mcp import MCPClient

client = MCPClient("android-emulator")

# å¯åŠ¨æ¨¡æ‹Ÿå™¨
await client.call("start_emulator", {"avd_name": "Pixel_6_API_33"})

# æ‰“å¼€åŒèŠ±é¡º
await client.call("open_app", {"package_name": "com.hexin.plat"})

# æœç´¢è‚¡ç¥¨
await client.call("search_stock", {"stock_code": "688011"})

# æˆªå›¾
await client.call("take_screenshot", {"output_path": "/tmp/stock.png"})

# VLM åˆ†æ
result = await client.call("analyze_chart", {"image_path": "/tmp/stock.png"})
print(result)  # {"signal": "ä¹°å…¥", "reason": "æ”¾é‡çªç ´..."}

# åœæ­¢æ¨¡æ‹Ÿå™¨
await client.call("stop_emulator")
```

---

## ä¸ç°æœ‰æ¨¡å—çš„å…³ç³»

| æ¨¡å— | å…³ç³» |
|------|------|
| tom_strategies æŠ€æœ¯ä¿¡å·æ£€æµ‹ | **äº’è¡¥**ï¼šæ•°å€¼åˆ†æ vs è§†è§‰åˆ†æ |
| PLAN_03 åˆ†æ—¶å›¾ VLM åˆ†æ | **ä¸åŒæº**ï¼šTushareæ•°æ® vs æ¨¡æ‹Ÿå™¨æˆªå›¾ |
| MCP Server | **æ–°æ¨¡å—**ï¼šæä¾›è‡ªæˆ‘æ“ä½œèƒ½åŠ› |

---

## éªŒæ”¶æ ‡å‡†

- [ ] MCP Server æ­£å¸¸è¿è¡Œ
- [ ] æ‰€æœ‰å·¥å…·å¯é€šè¿‡ MCP è°ƒç”¨
- [ ] AI Agent èƒ½è‡ªæˆ‘æ“ä½œå®Œæˆå…¨æµç¨‹
- [ ] èƒ½å¤Ÿæˆªå–åŒèŠ±é¡ºåˆ†æ—¶/Kçº¿å›¾
- [ ] VLM èƒ½å¤Ÿè¯†åˆ«æŠ€æœ¯ä¿¡å·

---

*æœ€åæ›´æ–°: 2026-02-03 14:25 (æ·»åŠ è°ƒç ”ç»“è®º + AVDå‘½ä»¤ + å¸¸è§å‘ä½)*
