# Chroma å‘é‡åŒ–çŸ¥è¯†åº“æ¥å…¥

**ä»»åŠ¡ ID**: T031
**ä¼˜å…ˆçº§**: P1
**åˆ›å»ºæ—¶é—´**: 2026-02-03 16:47
**çŠ¶æ€**: âœ… è°ƒç ”å®Œæˆ

**å®Œæˆæ—¶é—´**: 2026-02-03 16:50

---

## è°ƒç ”ç»“è®º

**ç»“è®º**: âœ… **æ¨èæ¥å…¥ Chroma**ï¼Œç¬¦åˆéœ€æ±‚

- **å®‰è£…ç®€å•**: `pip install chromadb`
- **æœ¬åœ°è¿è¡Œ**: é»˜è®¤æœ¬åœ°æ¨¡å¼ï¼Œæ— éœ€æœåŠ¡å™¨
- **å†…ç½® Embedding**: é»˜è®¤ä½¿ç”¨ `all-MiniLM-L6-v2` (çº¦90MB)
- **æ•°æ®æŒä¹…åŒ–**: SQLite å­˜å‚¨åœ¨æœ¬åœ°

---

## æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| Client | æ•°æ®åº“å®¢æˆ·ç«¯ (æœ¬åœ°/äº‘ç«¯) |
| Collection | é›†åˆï¼Œå­˜å‚¨ embeddings + documents + metadata |
| Embedding | æ–‡æœ¬å‘é‡è¡¨ç¤ºï¼Œç”¨äºè¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®— |
| Query | åŸºäºå‘é‡ç›¸ä¼¼åº¦çš„æœç´¢ |

---

## å®‰è£…ä¸ä½¿ç”¨

### 1. å®‰è£…

```bash
pip install chromadb sentence-transformers
```

### 2. åŸºç¡€ä½¿ç”¨

```python
import chromadb

# åˆ›å»ºæœ¬åœ°å®¢æˆ·ç«¯ (æ•°æ®å­˜å‚¨åœ¨ ./chroma_db)
chroma_client = chromadb.Client()

# åˆ›å»º/è·å–é›†åˆ
collection = chroma_client.get_or_create_collection(name="memory")

# æ·»åŠ æ–‡æ¡£ (è‡ªåŠ¨å‘é‡åŒ–)
collection.upsert(
    ids=["2026-02-03.md"],
    documents=["ä»Šæ—¥å·¥ä½œæ€»ç»“ï¼šå®Œæˆè¯­éŸ³è½¬æ–‡å­—ç³»ç»Ÿ..."],
    metadatas={"file_path": "memory/2026-02-03.md", "date": "2026-02-03"}
)

# è¯­ä¹‰æœç´¢
results = collection.query(
    query_texts=["ä»Šå¤©çš„å¼€å‘ä»»åŠ¡æœ‰å“ªäº›"],
    n_results=5
)
```

---

## Embedding æ¨¡å‹

**æ¥æº**: [PyPI é¡µé¢](https://pypi.org/project/chromadb/) æ˜ç¡®è¯´æ˜:
> "By default, Chroma uses **Sentence Transformers** to embed for you"

**é»˜è®¤æ¨¡å‹**: `all-MiniLM-L6-v2` (~90MB)

```python
# å†…ç½® all-MiniLM-L6-v2 (~90MB)
# æ— éœ€é¢å¤–é…ç½®ï¼Œè‡ªåŠ¨ä¸‹è½½
```

### Ollama æœ¬åœ°æ¨¡å‹ (è¿›é˜¶)

æ”¯æŒæœ¬åœ° Ollama æœåŠ¡ [[æ–‡æ¡£]](https://docs.trychroma.com/integrations/embedding-models/ollama)ï¼š

```python
from chromadb.utils.embedding_functions.ollama_embedding_function import OllamaEmbeddingFunction

ollama_ef = OllamaEmbeddingFunction(
    url="http://localhost:11434",
    model_name="qwen3-embedding:0.6b",  # âœ… å®æµ‹å¯ç”¨
)
```

**éªŒè¯ç»“æœ** (2026-02-03 17:09):
- âœ… Chroma + Ollama é›†æˆå¯ç”¨
- âœ… å‘é‡ç»´åº¦: 1024
- âœ… å“åº”æ—¶é—´: ~2 ç§’
- âœ… æ¨¡å‹å¤§å°: 639 MB

### æœ¬åœ° HuggingFace æ¨¡å‹ (å¯é€‰)

```python
# æ›´å¤§çš„æœ¬åœ°æ¨¡å‹
ef = embedding_functions.SentenceTransformerEmbeddingFunction("all-mpnet-base-v2")  # ~420MB
```

### äº‘ç«¯æ¨¡å‹ (ä¸æ¨è)

```python
# OpenAI (éœ€è¦ API Key)
ef = embedding_functions.OpenAIEmbeddingFunction(api_key="...")
```

**å»ºè®®**: ä½¿ç”¨é»˜è®¤çš„ `all-MiniLM-L6-v2`ï¼Œå¤Ÿç”¨ä¸”æ— éœ€é¢å¤–é…ç½®ã€‚åç»­å¯æŒ‰éœ€åˆ‡æ¢ Ollamaã€‚

---

## ä¸ memory/ ç›®å½•æ•´åˆæ–¹æ¡ˆ

### æ•°æ®ç»“æ„è®¾è®¡

```python
# Collection: memory
# ID: æ–‡ä»¶å (å¦‚ "2026-02-03.md")
# Document: æ–‡ä»¶å†…å®¹
# Metadata: file_path, date, tags
```

### åŒæ­¥ç­–ç•¥

1. **é¦–æ¬¡å¯¼å…¥**: æ‰«ææ‰€æœ‰ `memory/*.md`ï¼Œæ‰¹é‡å¯¼å…¥
2. **å¢é‡æ›´æ–°**: 
   - æ£€æµ‹æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶
   - ä½¿ç”¨ `upsert` æ›´æ–°å‘é‡
3. **åˆ é™¤åŒæ­¥**: æ£€æµ‹åˆ é™¤çš„æ–‡ä»¶ï¼Œä» Chroma ä¸­åˆ é™¤

### æ¥å£å°è£…

```python
class MemoryVectorDB:
    def __init__(self, db_path="./memory_db"):
        self.client = chromadb.Client()
        self.collection = self.client.get_or_create_collection("memory")
    
    def add_memory(self, file_path: str, content: str):
        """æ–°å¢è®°å¿†"""
        self.collection.upsert(
            ids=[file_path],
            documents=[content],
            metadatas={"file_path": file_path}
        )
    
    def search(self, query: str, n: int = 5):
        """è¯­ä¹‰æœç´¢"""
        return self.collection.query(query_texts=[query], n_results=n)
    
    def delete_memory(self, file_path: str):
        """åˆ é™¤è®°å¿†"""
        self.collection.delete(ids=[file_path])
```

---

## ä¼˜ç¼ºç‚¹

### âœ… ä¼˜ç‚¹

1. **å®‰è£…ç®€å•**: å•åŒ…å®‰è£…ï¼Œæ— å¤æ‚ä¾èµ–
2. **æœ¬åœ°è¿è¡Œ**: æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ— éœ€æœåŠ¡å™¨
3. **é»˜è®¤ embedding**: å†…ç½®æ¨¡å‹ï¼Œå¼€ç®±å³ç”¨
4. **API ç®€æ´**: 10 è¡Œä»£ç å³å¯å®ç°åŸºç¡€åŠŸèƒ½
5. **Python åŸç”Ÿ**: ä¸ç°æœ‰ OpenClaw æ— ç¼é›†æˆ

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¹¶å‘å†™å…¥**: å¤šè¿›ç¨‹å†™å…¥éœ€åŠ é”
2. **æ¨¡å‹ä¸‹è½½**: é¦–æ¬¡ä½¿ç”¨è‡ªåŠ¨ä¸‹è½½ ~90MB
3. **Python ç‰ˆæœ¬**: éœ€ Python 3.8+
4. **æ•°æ®è¿ç§»**: åç»­åˆ‡æ¢å‘é‡åº“éœ€å¯¼å‡º

---

## ğŸ“Š ä»Šæ—¥å¼€å‘æˆæœ (2026-02-03)

### å·²å®Œæˆ

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| MemoryVectorDB ç±» | âœ… | å°è£… Chroma + Ollama æ“ä½œ |
| é¦–æ¬¡å¯¼å…¥ | âœ… | 25 ä¸ªè®°å¿†æ–‡ä»¶å¯¼å…¥æˆåŠŸ |
| è¯­ä¹‰æœç´¢æµ‹è¯• | âœ… | æœç´¢ "è¯­éŸ³è¯†åˆ«"ã€"kçº¿å›¾" éªŒè¯é€šè¿‡ |
| **T032 ç›®å½•ç›‘å¬** | âœ… | sync_watcher.py (ç›‘å¬ + å®šæ—¶) |
| **T033 å¯¹è¯æå–** | âœ… | conversation_extractor.py |
| **T034 è‡ªåŠ¨æ•´åˆ** | âœ… | auto_memory_sync.py |
| Skill æ³¨å†Œ | âœ… | skills/memory-vector-db/ |

### æŠ€æœ¯æ ˆ

```
Chroma 1.4.1 (å‘é‡æ•°æ®åº“)
    â†“
Ollama qwen3-embedding:0.6b (æœ¬åœ° embedding)
    â†“
memory/ ç›®å½• (25 ä¸ª .md æ–‡ä»¶)
```

### éªŒè¯ç»“æœ

```bash
ğŸ” æœç´¢ "kçº¿å›¾"
âœ… å¬å›: 2026-01-31-stock-kline.md (ç›¸ä¼¼åº¦ 59.4%)

ğŸ” æœç´¢ "è¯­éŸ³è¯†åˆ« è½¬æ–‡å­—"
âœ… å¬å›: 2026-02-03-morning-brief.md (ç›¸ä¼¼åº¦ 58.7%)
```

### æ–°å¢æ–‡ä»¶

```
projects/memory-vector-db/src/
â”œâ”€â”€ memory_vector_db.py      # æ ¸å¿ƒç±»
â”œâ”€â”€ sync_watcher.py         # ç›®å½•ç›‘å¬ (T032)
â”œâ”€â”€ conversation_extractor.py # å¯¹è¯æå– (T033)
â””â”€â”€ auto_memory_sync.py     # æ•´åˆæ¨¡å— (T034)

skills/memory-vector-db/
â””â”€â”€ SKILL.md               # Skill é…ç½®
```

---

## ğŸ¯ å¤–ç½®ç¬¬äºŒå¤§è„‘ - å®Œæˆï¼

### âœ… å·²å®ç°
- è¯­ä¹‰æœç´¢è®°å¿†
- ç›®å½•ç›‘å¬è‡ªåŠ¨åŒæ­¥
- å¯¹è¯ä¿¡æ¯è‡ªåŠ¨æå–

### ğŸ“… ä¸‹ä¸€æ­¥
- [ ] OpenClaw å‘½ä»¤é›†æˆ (å¦‚ `/memory search xxx`)
- [ ] å®šæ—¶åŒæ­¥ cron job
- [ ] é‡è¦ä¿¡æ¯ä¼˜å…ˆçº§æ’åº

---

## å®‰è£…éªŒè¯

```bash
pip install chromadb sentence-transformers
```

(å®‰è£…ä¸­... é¢„è®¡ 1-2 åˆ†é’Ÿ)

---

*æœ€åæ›´æ–°: 2026-02-03 16:50*
