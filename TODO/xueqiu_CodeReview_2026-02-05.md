# Xueqiu é¡¹ç›® Code Review æŠ¥å‘Š

**å®¡æŸ¥æ—¥æœŸ**: 2026-02-05  
**å®¡æŸ¥è€…**: OpenClaw Agent  
**é¡¹ç›®è·¯å¾„**: `/Users/apple/openclaw/projects/xueqiu/`  
**é¡¹ç›®ç‰ˆæœ¬**: 0.1.0

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

Xueqiu æ˜¯ä¸€ä¸ªç”¨äºè®¿é—®é›ªçƒï¼ˆSnowballï¼‰è‚¡ç¥¨ API çš„ Python å®¢æˆ·ç«¯åº“ã€‚é›ªçƒæ˜¯ä¸­å›½çŸ¥åçš„è´¢ç»ç¤¾äº¤å¹³å°ï¼Œæä¾›è‚¡ç¥¨è¡Œæƒ…ã€Kçº¿æ•°æ®ã€æœç´¢ã€è‡ªé€‰è‚¡ç­‰åŠŸèƒ½ã€‚

### 1.2 é¡¹ç›®ç»“æ„

```
xueqiu/
â”œâ”€â”€ src/xueqiu/
â”‚   â”œâ”€â”€ __init__.py          # åŒ…åˆå§‹åŒ–ï¼Œå¯¼å‡º Client å’Œ XueqiuError
â”‚   â”œâ”€â”€ client.py            # æ ¸å¿ƒå®¢æˆ·ç«¯å®ç° (332 è¡Œ)
â”‚   â””â”€â”€ main.py              # CLI å…¥å£
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py          # pytest é…ç½®å’Œ fixture
â”‚   â”œâ”€â”€ test_client.py       # å®¢æˆ·ç«¯æµ‹è¯• (240+ æµ‹è¯•ç”¨ä¾‹)
â”‚   â””â”€â”€ test_errors.py       # å¼‚å¸¸ç±»æµ‹è¯•
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ get_cookie.py        # è‡ªåŠ¨è·å– Cookie è„šæœ¬ (Playwright)
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ERRORS.md            # é”™è¯¯ä»£ç æ–‡æ¡£
â”‚   â””â”€â”€ rate-limiting.md     # é€Ÿç‡é™åˆ¶æ–‡æ¡£
â”œâ”€â”€ requirements.txt         # ä¾èµ–é…ç½®
â”œâ”€â”€ pyproject.toml           # é¡¹ç›®é…ç½®
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

### 1.3 æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Python 3.x
- **HTTP å®¢æˆ·ç«¯**: requests åº“
- **è®¤è¯**: Cookie-based è®¤è¯
- **æµ‹è¯•æ¡†æ¶**: pytest
- **æµè§ˆå™¨è‡ªåŠ¨åŒ–**: Playwright (ç”¨äºè‡ªåŠ¨è·å– Cookie)

---

## 2. æ¶æ„åˆ†æ

### 2.1 æ ¸å¿ƒç»„ä»¶

#### 2.1.1 Client ç±» (`client.py`)

Client ç±»æ˜¯é¡¹ç›®çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£æ‰€æœ‰ API è¯·æ±‚ï¼š

**åˆå§‹åŒ–æµç¨‹**:
```
Cookie å‚æ•° â†’ .env æ–‡ä»¶ â†’ ç¯å¢ƒå˜é‡ (XUEQIU_COOKIE) â†’ æ— è®¤è¯
```

**å…³é”®é…ç½®**:
- `timeout`: è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ 30 ç§’ï¼‰
- `max_retries`: æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆé»˜è®¤ 3 æ¬¡ï¼‰
- `retry_delay`: é‡è¯•å»¶è¿ŸåŸºæ•°ï¼ˆé»˜è®¤ 2 ç§’ï¼‰

**ä¼šè¯è®¾ç½®** (`_setup_session`):
1. è®¾ç½®é»˜è®¤ HTTP headers
2. éšæœºé€‰æ‹© User-Agentï¼ˆé˜²æ­¢è¢«è¯†åˆ«ä¸ºçˆ¬è™«ï¼‰
3. é…ç½® V5 API å¿…éœ€çš„ headers
4. è®¾ç½® SSL éªŒè¯
5. é…ç½®é‡è¯•ç­–ç•¥ï¼ˆæŒ‡æ•°é€€é¿ï¼‰

#### 2.1.2 API ç«¯ç‚¹

**Base URLs**:
- `BASE_URL`: `https://stock.xueqiu.com` (æ—§ç‰ˆ API)
- `V5_BASE_URL`: `https://api.xueqiu.com` (V5 API)

**å·²å®ç°çš„ API æ–¹æ³•**:
| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| `getQuote()` | `/v5/stock/quote.json` | è·å–è‚¡ç¥¨è¡Œæƒ… |
| `getKline()` | `/v5/stock/candle.json` | è·å– K çº¿æ•°æ® |
| `getHotStocks()` | `/v5/stock/hot.json` | è·å–çƒ­é—¨è‚¡ç¥¨ |
| `getMarketStatus()` | `/v5/market/status.json` | è·å–å¸‚åœºçŠ¶æ€ |
| `search()` | `/v5/stock/search.json` | æœç´¢è‚¡ç¥¨ |
| `getPortfolio()` | `/v5/portfolio/{id}/holdings.json` | è·å–æŒä»“ |
| `getWatchlist()` | `/v5/user/watchlist/{id}/holdings.json` | è·å–è‡ªé€‰è‚¡ |

#### 2.1.3 é”™è¯¯å¤„ç†

**XueqiuError å¼‚å¸¸ç±»**:
- ç»§æ‰¿è‡ª `Exception`
- åŒ…å« `message`ã€`status_code`ã€`response_body` å±æ€§
- è¦†ç›– HTTP çŠ¶æ€ç ï¼š429, 500, 502, 503, 504
- æ”¯æŒæŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥

### 2.2 æ•°æ®æµ

```
ç”¨æˆ·ä»£ç  â†’ Client å®ä¾‹åŒ– â†’ Cookie è¯»å– â†’ Session é…ç½®
    â†“
API è°ƒç”¨æ–¹æ³• â†’ request() æ–¹æ³• â†’ HTTP è¯·æ±‚ â†’ å“åº”å¤„ç†
    â†“
è¿”å› JSON æ•°æ® / æŠ›å‡º XueqiuError
```

### 2.3 è®¤è¯æœºåˆ¶

é¡¹ç›®ä½¿ç”¨ Cookie-based è®¤è¯ï¼š

**Cookie è·å–æ–¹å¼**:
1. **è‡ªåŠ¨è·å–**: ä½¿ç”¨ Playwright è„šæœ¬ (`scripts/get_cookie.py`) æ¨¡æ‹Ÿæµè§ˆå™¨ç™»å½•
2. **æ‰‹åŠ¨è·å–**: ç”¨æˆ·ä»æµè§ˆå™¨å¤åˆ¶ Cookie
3. **ä¼˜å…ˆçº§**: æ„é€ å‡½æ•°å‚æ•° > .env æ–‡ä»¶ > ç¯å¢ƒå˜é‡

**Cookie åˆ·æ–°ç­–ç•¥**: ç›®å‰ä»…åœ¨è®¤è¯é”™è¯¯æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œéœ€ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°

---

## 3. å·²å®ç°åŠŸèƒ½

### 3.1 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è‚¡ç¥¨è¡Œæƒ…æŸ¥è¯¢ | âœ… å®Œæˆ | `getQuote()` æ”¯æŒå®æ—¶è¡Œæƒ… |
| Kçº¿æ•°æ®è·å– | âœ… å®Œæˆ | `getKline()` æ”¯æŒæ—¥/å‘¨/æœˆç­‰å‘¨æœŸ |
| çƒ­é—¨è‚¡ç¥¨ | âœ… å®Œæˆ | `getHotStocks()` |
| å¸‚åœºçŠ¶æ€ | âœ… å®Œæˆ | `getMarketStatus()` |
| è‚¡ç¥¨æœç´¢ | âœ… å®Œæˆ | `search()` æ”¯æŒå…³é”®è¯å’Œäº¤æ˜“æ‰€è¿‡æ»¤ |
| æŒä»“æŸ¥è¯¢ | âœ… å®Œæˆ | `getPortfolio()` |
| è‡ªé€‰è‚¡æŸ¥è¯¢ | âœ… å®Œæˆ | `getWatchlist()` |
| è®¤è¯æœºåˆ¶ | âœ… å®Œæˆ | Cookie è‡ªåŠ¨è¯»å– |
| é‡è¯•æœºåˆ¶ | âœ… å®Œæˆ | æŒ‡æ•°é€€é¿é‡è¯• |
| é”™è¯¯å¤„ç† | âœ… å®Œæˆ | è‡ªå®šä¹‰å¼‚å¸¸ç±» |

### 3.2 æµ‹è¯•è¦†ç›–

- **æµ‹è¯•æ–‡ä»¶**: `test_client.py`, `test_errors.py`
- **æµ‹è¯•ç±»**:
  - `TestClientInitialization`: åˆå§‹åŒ–æµ‹è¯•
  - `TestClientSessionSetup`: ä¼šè¯é…ç½®æµ‹è¯•
  - `TestClientRequest`: è¯·æ±‚æ–¹æ³•æµ‹è¯•
  - `TestClientRetryMechanism`: é‡è¯•æœºåˆ¶æµ‹è¯•
  - `TestClientAPI`: API æ–¹æ³•æµ‹è¯•
  - `TestClientURLs`: URL å¤„ç†æµ‹è¯•
- **Fixtures**: mock_cookie, mock_success_response, mock_429_response, client_with_cookie

### 3.3 æ–‡æ¡£

- âœ… README.md - å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… docs/ERRORS.md - é”™è¯¯ä»£ç æ–‡æ¡£
- âœ… docs/rate-limiting.md - é€Ÿç‡é™åˆ¶æ–‡æ¡£

---

## 4. å¾…å®ŒæˆåŠŸèƒ½ (TODO)

### 4.1 ä»£ç ä¸­æ—  TODO/FIXME æ³¨é‡Š

ç»è¿‡å…¨é¢æœç´¢ï¼Œé¡¹ç›®ä»£ç ä¸­æ²¡æœ‰æ˜¾å¼çš„ TODOã€FIXMEã€XXX æˆ– HACK æ³¨é‡Šã€‚

### 4.2 åŠŸèƒ½ç¼ºå¤±åˆ†æ

#### 4.2.1 API åŠŸèƒ½ç¼ºå¤±

| åŠŸèƒ½ | é‡è¦æ€§ | è¯´æ˜ |
|------|--------|------|
| Cookie è‡ªåŠ¨åˆ·æ–° | ğŸ”´ é«˜ | å½“å‰ Cookie è¿‡æœŸåéœ€æ‰‹åŠ¨æ›´æ–° |
| å¼‚æ­¥æ”¯æŒ | ğŸŸ¡ ä¸­ | ä»…æœ‰åŒæ­¥ APIï¼Œç¼ºå°‘ asyncio æ”¯æŒ |
| åˆ†é¡µæŸ¥è¯¢ | ğŸŸ¡ ä¸­ | æœç´¢ç­‰æ¥å£ç¼ºå°‘åˆ†é¡µå‚æ•° |
| è¯·æ±‚ç­¾å | ğŸŸ¡ ä¸­ | V5 API å¯èƒ½éœ€è¦è¯·æ±‚ç­¾å |
| WebSocket å®æ—¶æ¨é€ | ğŸŸ¢ ä½ | ç¼ºå°‘å®æ—¶è¡Œæƒ…è®¢é˜… |
| èµ„é‡‘æµå‘ | ğŸŸ¢ ä½ | ç¼ºå°‘èµ„é‡‘æµå‘æ•°æ®æ¥å£ |
| è´¢åŠ¡æŠ¥è¡¨ | ğŸŸ¢ ä½ | ç¼ºå°‘è´¢åŠ¡æŠ¥è¡¨ API |
| é›ªçƒç¤¾åŒºå†…å®¹ | ğŸŸ¢ ä½ | ç¼ºå°‘åŠ¨æ€ã€è®¨è®ºç­‰ç¤¾åŒºåŠŸèƒ½ |

#### 4.2.2 ä»£ç åŠŸèƒ½ç¼ºå¤±

| åŠŸèƒ½ | é‡è¦æ€§ | è¯´æ˜ |
|------|--------|------|
| ç±»å‹æç¤ºå®Œå–„ | ğŸŸ¡ ä¸­ | éƒ¨åˆ†å‡½æ•°ç¼ºå°‘å®Œæ•´ç±»å‹æ³¨è§£ |
| æ—¥å¿—é…ç½® | ğŸŸ¡ ä¸­ | ä»…æœ‰åŸºæœ¬ logging é…ç½® |
| ä»£ç†æ”¯æŒ | ğŸŸ¡ ä¸­ | ç¼ºå°‘ HTTP ä»£ç†é…ç½® |
| è¿æ¥æ± é…ç½® | ğŸŸ¡ ä¸­ | ç¼ºå°‘è¿æ¥æ± å¤§å°é…ç½® |
| ç¼“å­˜æœºåˆ¶ | ğŸŸ¢ ä½ | ç¼ºå°‘è¯·æ±‚ç¼“å­˜æ”¯æŒ |

### 4.3 å»ºè®®çš„ TODO åˆ—è¡¨

```python
# TODO: å®ç° Cookie è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
# TODO: æ·»åŠ  asyncio å¼‚æ­¥æ”¯æŒ
# TODO: å®ç°åˆ†é¡µæŸ¥è¯¢å‚æ•°
# TODO: æ·»åŠ è¯·æ±‚ç­¾åéªŒè¯æ”¯æŒ
# TODO: å®Œå–„ç±»å‹æç¤ºæ³¨è§£
# TODO: æ·»åŠ ä»£ç†é…ç½®æ”¯æŒ
# TODO: å®ç°è¯·æ±‚ç¼“å­˜å±‚
```

---

## 5. é£é™©ç‚¹åˆ†æ

### 5.1 é«˜é£é™©

#### 5.1.1 Cookie è¿‡æœŸé£é™©

**é£é™©æè¿°**: 
é›ªçƒ API ä½¿ç”¨ Cookie è¿›è¡Œè®¤è¯ï¼ŒCookie æœ‰æ•ˆæœŸæœ‰é™ï¼Œè¿‡æœŸå API è°ƒç”¨ä¼šè¿”å› 401/403 é”™è¯¯ã€‚

**å½“å‰çŠ¶æ€**: 
- âŒ æ— è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
- âŒ æ— è¿‡æœŸæ£€æµ‹
- âŒ æ— è¿‡æœŸé€šçŸ¥

**å»ºè®®**:
- å®ç° Cookie æœ‰æ•ˆæœŸæ£€æµ‹
- æä¾›è‡ªåŠ¨åˆ·æ–°æ¥å£
- æ·»åŠ è¿‡æœŸé¢„è­¦æœºåˆ¶

#### 5.1.2 IP å°ç¦é£é™©

**é£é™©æè¿°**: 
é«˜é¢‘è¯·æ±‚æˆ–å¼‚å¸¸è¡Œä¸ºå¯èƒ½å¯¼è‡´ IP è¢«å°ç¦ã€‚

**å½“å‰çŠ¶æ€**:
- âœ… æœ‰é€Ÿç‡é™åˆ¶å¤„ç†ï¼ˆ429ï¼‰
- âœ… æœ‰é‡è¯•æœºåˆ¶ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- âš ï¸ ç¼ºå°‘è¯·æ±‚é¢‘ç‡ç»Ÿè®¡
- âš ï¸ ç¼ºå°‘ IP å°ç¦æ£€æµ‹

**å»ºè®®**:
- æ·»åŠ è¯·æ±‚é¢‘ç‡ç»Ÿè®¡å’Œå‘Šè­¦
- å®ç°è¯·æ±‚é—´éš”æ§åˆ¶
- æ·»åŠ å°ç¦æ£€æµ‹å’Œæ¢å¤å»ºè®®

### 5.2 ä¸­é£é™©

#### 5.2.1 SSL/TLS éªŒè¯

**é£é™©æè¿°**:
```python
self._session.verify = True  # ç¡¬ç¼–ç ä¸º True
```

å½“å‰é…ç½®å›ºå®šä¸º Trueï¼Œä½†åœ¨æŸäº›ç½‘ç»œç¯å¢ƒä¸‹å¯èƒ½éœ€è¦ç¦ç”¨ã€‚

**å»ºè®®**:
- æ·»åŠ  `verify_ssl` é…ç½®å‚æ•°

#### 5.2.2 é”™è¯¯å¤„ç†ä¸å®Œæ•´

**é£é™©æè¿°**:
```python
if data.get("error_code") != 0:
    # åªæ£€æŸ¥ error_codeï¼Œå¯èƒ½é—æ¼å…¶ä»–é”™è¯¯åœºæ™¯
```

**å»ºè®®**:
- å¢å¼ºé”™è¯¯å“åº”éªŒè¯
- æ·»åŠ æ›´å¤šé”™è¯¯ç æ”¯æŒ

#### 5.2.3 æ—¥å¿—æ•æ„Ÿä¿¡æ¯æ³„éœ²

**é£é™©æè¿°**:
```python
logger.info(f"Params: {params}")  # å¯èƒ½æ‰“å°æ•æ„Ÿä¿¡æ¯
logger.info(f"Body: {body}")      # å¯èƒ½æ‰“å° Cookie
```

**å»ºè®®**:
- è¿‡æ»¤æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ Cookieã€tokenï¼‰

### 5.3 ä½é£é™©

#### 5.3.1 éšæœº User-Agent

```python
self._user_agent = random.choice(DEFAULT_USER_AGENTS)
```

æ¯æ¬¡å®ä¾‹åŒ–éƒ½éšæœºé€‰æ‹© User-Agentï¼Œå¯èƒ½å¯¼è‡´è¡Œä¸ºä¸ä¸€è‡´ã€‚

**å»ºè®®**:
- å¯ä»¥è€ƒè™‘æ·»åŠ  User-Agent é…ç½®é€‰é¡¹

#### 5.3.2 ç¡¬ç¼–ç çš„ API ç‰ˆæœ¬

```python
V5_REQUIRED_HEADERS = {
    "X-Quote-Version": "5.36.15",
    ...
}
```

API ç‰ˆæœ¬ç¡¬ç¼–ç ï¼Œå¯èƒ½éšæ—¶é—´å¤±æ•ˆã€‚

**å»ºè®®**:
- æ·»åŠ ç‰ˆæœ¬é…ç½®æˆ–è‡ªåŠ¨æ£€æµ‹æœºåˆ¶

---

## 6. æ”¹è¿›å»ºè®®

### 6.1 æ¶æ„æ”¹è¿›

#### 6.1.1 æ·»åŠ å¼‚æ­¥æ”¯æŒ

```python
# å»ºè®®æ–°å¢ async_client.py
import aiohttp

class AsyncClient:
    async def getQuote(self, symbol: str) -> dict:
        """å¼‚æ­¥è·å–è‚¡ç¥¨è¡Œæƒ…"""
        pass
    
    async def getKline(self, symbol: str, period: str = "day") -> dict:
        """å¼‚æ­¥è·å– K çº¿æ•°æ®"""
        pass
```

#### 6.1.2 æ·»åŠ  Cookie ç®¡ç†å™¨

```python
class CookieManager:
    def __init__(self, cookie: str):
        self.cookie = cookie
        self.expiry = None
    
    def is_expired(self) -> bool:
        """æ£€æŸ¥ Cookie æ˜¯å¦è¿‡æœŸ"""
        pass
    
    async def refresh(self) -> str:
        """è‡ªåŠ¨åˆ·æ–° Cookie"""
        pass
```

#### 6.1.3 å®ç°è¯·æ±‚ç¼“å­˜

```python
from functools import lru_cache

class CachedClient(Client):
    @lru_cache(maxsize=128)
    def getQuote(self, symbol: str) -> dict:
        """å¸¦ç¼“å­˜çš„è¡Œæƒ…æŸ¥è¯¢"""
        return super().getQuote(symbol)
```

### 6.2 ä»£ç è´¨é‡æ”¹è¿›

#### 6.2.1 å¢å¼ºç±»å‹æ³¨è§£

```python
# å½“å‰
def request(
    self,
    method: str,
    path: str,
    params: Optional[dict] = None,
    body: Optional[dict] = None,
    v5: bool = False,
) -> dict:

# å»ºè®®
from typing import TypedDict, Literal

APIResponse = TypedDict('APIResponse', {'error_code': int, 'data': Any})

def request(
    self,
    method: Literal['GET', 'POST', 'PUT', 'DELETE'],
    path: str,
    params: Optional[dict[str, Any]] = None,
    body: Optional[dict[str, Any]] = None,
    v5: bool = False,
) -> APIResponse:
```

#### 6.2.2 æ·»åŠ æ—¥å¿—è¿‡æ»¤

```python
import logging

class SensitiveDataFilter(logging.Filter):
    def filter(self, record):
        # è¿‡æ»¤æ•æ„Ÿä¿¡æ¯
        if 'Cookie' in record.msg:
            record.msg = record.msg.replace(self._cookie, '***')
        return True
```

#### 6.2.3 å®Œå–„é”™è¯¯å¤„ç†

```python
class XueqiuError(Exception):
    """å¢å¼ºçš„é”™è¯¯ç±»"""
    
    ERROR_CODES = {
        10001: "Invalid parameter",
        10002: "Authentication failed",
        10004: "Rate limited",
        # ... æ›´å¤šé”™è¯¯ç 
    }
    
    def get_error_description(self) -> str:
        """è·å–äººç±»å¯è¯»çš„é”™è¯¯æè¿°"""
        if self.status_code in self.ERROR_CODES:
            return self.ERROR_CODES[self.status_code]
        return self.message
```

### 6.3 åŠŸèƒ½å¢å¼º

#### 6.3.1 æ·»åŠ ä»£ç†æ”¯æŒ

```python
def __init__(
    self,
    cookie: Optional[str] = None,
    timeout: int = 30,
    proxy: Optional[str] = None,  # æ–°å¢
    max_retries: int = 3,
    retry_delay: int = 2,
):
    # ...
    self._proxy = proxy
```

#### 6.3.2 æ·»åŠ é€Ÿç‡é™åˆ¶å™¨

```python
import time
from collections import deque

class RateLimiter:
    def __init__(self, max_requests: int = 60, per_seconds: int = 60):
        self.max_requests = max_requests
        self.per_seconds = per_seconds
        self.requests = deque()
    
    def acquire(self) -> float:
        """è·å–è¯·æ±‚è®¸å¯ï¼Œè¿”å›ç­‰å¾…æ—¶é—´"""
        now = time.time()
        while self.requests and now - self.requests[0] > self.per_seconds:
            self.requests.popleft()
        
        if len(self.requests) >= self.max_requests:
            wait_time = self.requests[0] + self.per_seconds - now
            time.sleep(wait_time)
            return wait_time
        
        self.requests.append(now)
        return 0
```

### 6.4 æµ‹è¯•æ”¹è¿›

#### 6.4.1 æ·»åŠ é›†æˆæµ‹è¯•

```python
# tests/test_integration.py
import pytest

@pytest.mark.integration
class TestIntegration:
    def test_real_api_call(self):
        """å®é™… API è°ƒç”¨æµ‹è¯•"""
        client = Client()
        quote = client.getQuote("SH000001")
        assert "current_price" in quote
```

#### 6.4.2 æ·»åŠ æ€§èƒ½æµ‹è¯•

```python
# tests/test_performance.py
import time

def test_request_latency(client):
    """æµ‹è¯•è¯·æ±‚å»¶è¿Ÿ"""
    start = time.time()
    client.getQuote("SH000001")
    latency = time.time() - start
    assert latency < 5.0  # 5 ç§’å†…å“åº”
```

---

## 7. ä»£ç è´¨é‡è¯„ä¼°

### 7.1 è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| ä»£ç è§„èŒƒ | â­â­â­â­ | PEP 8 è§„èŒƒï¼Œç±»å‹æ³¨è§£åŸºæœ¬å®Œæ•´ |
| æ¶æ„è®¾è®¡ | â­â­â­ | ç»“æ„æ¸…æ™°ï¼ŒèŒè´£åˆ†æ˜ |
| æµ‹è¯•è¦†ç›– | â­â­â­â­ | æµ‹è¯•ç”¨ä¾‹ä¸°å¯Œï¼Œè¦†ç›–ä¸»è¦åœºæ™¯ |
| æ–‡æ¡£å®Œå–„ | â­â­â­â­ | README å’Œé”™è¯¯æ–‡æ¡£å®Œæ•´ |
| é”™è¯¯å¤„ç† | â­â­â­ | åŸºç¡€é”™è¯¯å¤„ç†å®Œå–„ï¼Œç¼ºå°‘é«˜çº§ç‰¹æ€§ |
| å®‰å…¨æ€§ | â­â­â­ | Cookie å­˜å‚¨åŸºæœ¬å®‰å…¨ï¼Œéœ€æ”¹è¿›åˆ·æ–°æœºåˆ¶ |
| æ€§èƒ½ | â­â­â­ | åŒæ­¥å®ç°ï¼Œéœ€å¼‚æ­¥æ”¯æŒ |
| å¯ç»´æŠ¤æ€§ | â­â­â­â­ | ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤ |

**ç»¼åˆè¯„åˆ†**: â­â­â­ (3.5/5)

### 7.2 ä¼˜ç‚¹

1. âœ… **ä»£ç ç»“æ„æ¸…æ™°**: æ¨¡å—åˆ’åˆ†åˆç†ï¼ŒèŒè´£æ˜ç¡®
2. âœ… **å®Œå–„çš„é”™è¯¯å¤„ç†**: è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
3. âœ… **è‰¯å¥½çš„é‡è¯•æœºåˆ¶**: æŒ‡æ•°é€€é¿ç­–ç•¥å¤„ç†ä¸´æ—¶æ€§é”™è¯¯
4. âœ… **å®Œæ•´çš„æµ‹è¯•è¦†ç›–**: ä¸»è¦åŠŸèƒ½éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹
5. âœ… **è¯¦ç»†çš„æ–‡æ¡£**: README å’Œé”™è¯¯å¤„ç†æ–‡æ¡£å®Œå–„
6. âœ… **çµæ´»çš„é…ç½®**: æ”¯æŒå¤šç§ Cookie è·å–æ–¹å¼
7. âœ… **å¤š User-Agent**: éšæœºé€‰æ‹©é™ä½è¢«å°ç¦é£é™©

### 7.3 éœ€æ”¹è¿›ä¹‹å¤„

1. âš ï¸ **ç¼ºå°‘å¼‚æ­¥æ”¯æŒ**: ä»…æœ‰åŒæ­¥ APIï¼Œä¸èƒ½æ»¡è¶³é«˜å¹¶å‘åœºæ™¯
2. âš ï¸ **Cookie ç®¡ç†ä¸å®Œå–„**: æ— è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
3. âš ï¸ **ç¼ºå°‘ä»£ç†æ”¯æŒ**: ä¸èƒ½é…ç½®ä»£ç† IP
4. âš ï¸ **æ—¥å¿—å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯**: éœ€æ·»åŠ è¿‡æ»¤
5. âš ï¸ **ç¡¬ç¼–ç  API ç‰ˆæœ¬**: ç¼ºå°‘ç‰ˆæœ¬ç®¡ç†æœºåˆ¶
6. âš ï¸ **ç¼ºå°‘åˆ†é¡µæ”¯æŒ**: æœç´¢ç­‰æ¥å£ä¸æ”¯æŒåˆ†é¡µ
7. âš ï¸ **è¯·æ±‚ç¼“å­˜ç¼ºå¤±**: é«˜é¢‘æŸ¥è¯¢æ— ç¼“å­˜æœºåˆ¶

---

## 8. æ€»ç»“

### 8.1 é¡¹ç›®çŠ¶æ€

Xueqiu é¡¹ç›®æ˜¯ä¸€ä¸ª**åŠŸèƒ½åŸºæœ¬å®Œæ•´**çš„é›ªçƒ API Python å®¢æˆ·ç«¯åº“ï¼Œå·²å®ç°è‚¡ç¥¨è¡Œæƒ…ã€Kçº¿æ•°æ®ã€æœç´¢ã€æŒä»“æŸ¥è¯¢ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ä»£ç è´¨é‡è‰¯å¥½ï¼Œæµ‹è¯•è¦†ç›–å®Œå–„ï¼Œæ–‡æ¡£é½å…¨ã€‚

### 8.2 é€‚ç”¨åœºæ™¯

å½“å‰ç‰ˆæœ¬é€‚ç”¨äºï¼š
- âœ… ç®€å•çš„è‚¡ç¥¨è¡Œæƒ…æŸ¥è¯¢
- âœ… ä½é¢‘æ•°æ®è·å–ï¼ˆåˆ†é’Ÿçº§é—´éš”ï¼‰
- âœ… ä¸ªäººæŠ•èµ„è¾…åŠ©å·¥å…·
- âœ… æ•°æ®åˆ†æå’Œå›æµ‹ç³»ç»Ÿ

### 8.3 ä¸é€‚ç”¨åœºæ™¯

å½“å‰ç‰ˆæœ¬ä¸é€‚ç”¨äºï¼š
- âŒ é«˜é¢‘äº¤æ˜“ç³»ç»Ÿï¼ˆç¼ºå°‘å¼‚æ­¥æ”¯æŒï¼‰
- âŒ å®æ—¶è¡Œæƒ…ç›‘æ§ï¼ˆç¼ºå°‘ WebSocketï¼‰
- âŒ å¤§è§„æ¨¡æ•°æ®é‡‡é›†ï¼ˆç¼ºå°‘ä»£ç†å’Œ Cookie åˆ·æ–°ï¼‰
- âŒ ç”Ÿäº§ç¯å¢ƒæœåŠ¡ï¼ˆç¼ºå°‘å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ï¼‰

### 8.4 ä¼˜å…ˆæ”¹è¿›å»ºè®®

1. **é«˜ä¼˜å…ˆçº§**: å®ç° Cookie è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
2. **é«˜ä¼˜å…ˆçº§**: æ·»åŠ å¼‚æ­¥æ”¯æŒ (asyncio)
3. **ä¸­ä¼˜å…ˆçº§**: å¢å¼ºé”™è¯¯å¤„ç†å’Œæ—¥å¿—å®‰å…¨
4. **ä¸­ä¼˜å…ˆçº§**: æ·»åŠ ä»£ç†æ”¯æŒ
5. **ä½ä¼˜å…ˆçº§**: å®ç°è¯·æ±‚ç¼“å­˜

---

## 9. å‚è€ƒé“¾æ¥

- **é›ªçƒå®˜ç½‘**: https://xueqiu.com
- **é¡¹ç›®æ–‡æ¡£**: å‚è§ `/Users/apple/openclaw/projects/xueqiu/README.md`
- **é”™è¯¯æ–‡æ¡£**: å‚è§ `/Users/apple/openclaw/projects/xueqiu/docs/ERRORS.md`

---

*æœ¬æŠ¥å‘Šç”± OpenClaw Agent è‡ªåŠ¨ç”Ÿæˆ*
