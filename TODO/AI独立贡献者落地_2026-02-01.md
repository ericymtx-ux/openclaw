# AI独立贡献者架构落地

**创建日期**: 2026-02-01
**状态**: pending
**负责人**: Monday (AI Assistant)
**参考**: `ideas/AI独立贡献者架构-2026-02-01.md`

## 需求描述

让 Monday (我) 能够在用户睡觉时自主工作，完成代码审查、文档更新、数据收集、报告生成等任务。

## 当前能力盘点 ✅

| 能力 | 状态 | 说明 |
|------|------|------|
| 读写文件 | ✅ | read/write/edit |
| 执行命令 | ✅ | exec/process |
| 访问代码库 | ✅ | /Users/apple/openclaw |
| Git操作 | ✅ | git add/commit/push |
| 定时触发 | ✅ | HEARTBEAT.md (23:00) |
| 发送消息 | ✅ | Telegram |
| 浏览器控制 | ✅ | browser tool |
| 模型切换 | ✅ | Opus/MiniMax |

## 缺少的能力/配置 ❌

### 1. 任务队列系统
**问题**: 没有明确的"夜间待办任务列表"
**现状**: HEARTBEAT.md 只定义了反思流程，没有任务队列
**需要**: 
- [ ] 创建 `NIGHT_TASKS.md` - 夜间任务列表
- [ ] 定义任务优先级和预估时间
- [ ] 支持任务状态追踪 (pending/running/done/failed)

### 2. 工作边界定义
**问题**: 不清楚哪些操作可以自主执行，哪些需要确认
**需要**:
- [ ] 定义"安全操作"清单 (自主执行)
  - 代码审查、文档更新、测试编写
  - 数据收集、报告生成
  - TODO/ideas 整理
- [ ] 定义"敏感操作"清单 (需确认)
  - git push 到 main
  - 删除文件
  - 修改配置
  - 发送外部消息
- [ ] 更新 SOUL.md 或创建 BOUNDARIES.md

### 3. PR工作流
**问题**: 用户要求"只创建PR，不直接push"，但当前没有这个流程
**需要**:
- [ ] 夜间工作在独立分支进行
- [ ] 完成后创建 PR (用 gh cli)
- [ ] 通知用户审查
- [ ] 分支命名规范: `monday/YYYY-MM-DD-task-name`

### 4. 通知机制
**问题**: 任务完成/失败后如何通知用户？
**需要**:
- [ ] 任务完成 → Telegram 消息通知
- [ ] 任务失败 → 错误报告 + 通知
- [ ] 每日工作汇总 → 早晨发送

### 5. 错误处理与回滚
**问题**: 任务失败时如何处理？
**需要**:
- [ ] 每个任务开始前 git stash 或创建分支
- [ ] 失败时自动回滚
- [ ] 记录错误日志供调试

### 6. Token预算控制
**问题**: 夜间工作如何控制成本？
**需要**:
- [ ] 定义每晚Token预算上限
- [ ] 优先使用低成本模型 (MiniMax)
- [ ] 复杂决策才切换 Opus
- [ ] 记录每晚消耗

### 7. 执行工具链
**问题**: opencode CLI 未安装
**现状**: 
- opencode CLI: ❌ 未安装
- claude-team skill: ✅ 已有
- Claude Code: ✅ 已安装
**决策**:
- [ ] 方案A: 安装 opencode CLI (`pnpm add -g @opencode-ai/cli`)
- [ ] 方案B: 直接使用 exec + 本地工具
- [ ] 方案C: 使用 claude-team 管理子任务
- **建议**: 先用方案B (exec)，保持简单

## 实施计划

### Phase 1: 基础配置 (今晚可完成)
- [ ] 创建 `NIGHT_TASKS.md` 模板
- [ ] 创建 `BOUNDARIES.md` 定义工作边界
- [ ] 更新 `HEARTBEAT.md` 集成夜间任务

### Phase 2: 工作流 (Day 2)
- [ ] 实现分支工作流
- [ ] 实现 PR 创建 (gh cli)
- [ ] 测试完整流程

### Phase 3: 通知与监控 (Day 3)
- [ ] 实现 Telegram 通知
- [ ] 实现错误处理
- [ ] 实现工作日志

### Phase 4: 优化 (Day 4+)
- [ ] Token 预算控制
- [ ] 任务优先级调度
- [ ] 多任务并行

## 今晚测试任务

如果用户同意，今晚 23:00 我可以尝试：

1. **低风险任务**: 
   - 整理 TODO 目录，更新状态
   - 检查 ideas 目录，补充细节
   - 生成第一份投资日报 (mock数据)

2. **中风险任务**:
   - 创建 `monday/2026-02-01-first-night` 分支
   - 完成一个小改动
   - 创建 PR

**等待用户确认后执行**

## 验收标准

- [ ] NIGHT_TASKS.md 存在且格式清晰
- [ ] BOUNDARIES.md 定义了安全/敏感操作
- [ ] 能在独立分支工作并创建 PR
- [ ] 任务完成后能发送 Telegram 通知
- [ ] 有错误处理和回滚机制

## 相关链接

- 架构设计: `ideas/AI独立贡献者架构-2026-02-01.md`
- 当前心跳: `HEARTBEAT.md`
- claude-team: `skills/claude-team/`
- opencode-team: `skills/opencode-team/`

---
*创建时间: 2026-02-01*
*这是我 (Monday) 对自己能力的审视*
