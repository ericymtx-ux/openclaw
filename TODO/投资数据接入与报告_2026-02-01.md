# 投资数据接入与报告系统

**创建日期**: 2026-02-01
**状态**: pending
**负责人**: Monday (AI Assistant)

## 需求描述

接入雪球、tushare等数据源，自动生成投资分析报告，为"投资增值服务"提供数据支撑。

## 数据源分析

### 雪球 (xueqiu.com)
- **状态**: 已调研完成 ✅
- **优势**: 社区数据、大V持仓、组合跟踪
- **接入方式**: HTTP API + Cookie
- **详见**: `TODO/雪球数据接口调研_2026-02-01.md`

### Tushare (tushare.pro)
- **状态**: 未接入 ❌
- **优势**: 专业金融数据、历史数据完整、API稳定
- **接入方式**: Python SDK + Token

**Tushare 可获取数据**:
| 类别 | 数据项 | 更新频率 |
|------|--------|----------|
| 行情 | 日线/分钟线/Tick | 实时 |
| 财务 | 三大报表、财务指标 | 季度 |
| 基本面 | 股本、分红、股东 | 事件触发 |
| 资金 | 龙虎榜、大宗交易、融资融券 | 日 |
| 指数 | 指数行情、成分股 | 日 |
| 基金 | 净值、持仓、分红 | 日/季 |

**Tushare 积分要求**:
- 基础数据: 120积分 (注册即送)
- 高级数据: 2000积分 (需贡献或付费)
- 注册: https://tushare.pro/register

### 数据源互补策略

| 数据类型 | 首选源 | 备选源 | 原因 |
|----------|--------|--------|------|
| 历史行情 | Tushare | 雪球 | Tushare更完整 |
| 实时行情 | 雪球 | Tushare | 雪球无延迟 |
| 财务数据 | Tushare | 雪球 | Tushare格式标准 |
| 社区情绪 | 雪球 | - | 雪球独有 |
| 大V观点 | 雪球 | - | 雪球独有 |
| 组合持仓 | 雪球 | - | 雪球独有 |

## 报告类型设计

### 报告1: 每日投资机会 (Daily)
**触发时间**: 每日 18:00
**内容**:
- [ ] 今日涨跌幅TOP10
- [ ] 异动股票提醒 (放量/突破)
- [ ] 大V持仓变动
- [ ] 龙虎榜数据
- [ ] 明日关注标的

### 报告2: 周度策略复盘 (Weekly)
**触发时间**: 每周六 10:00
**内容**:
- [ ] 本周市场概览
- [ ] 策略表现回顾
- [ ] 持仓盈亏分析
- [ ] 下周操作计划

### 报告3: 选股策略报告 (On-demand)
**触发方式**: 用户请求
**内容**:
- [ ] 小市值价值股筛选
- [ ] 技术形态筛选
- [ ] 基本面评分
- [ ] 风险提示

## 任务拆解

### 阶段 1: Tushare 接入 (Day 1-2)
- [ ] 1.1 安装 tushare: `pip3 install tushare`
- [ ] 1.2 注册账号获取 token
- [ ] 1.3 配置 token 到 `~/.tushare_token`
- [ ] 1.4 验证基础 API 调用
- [ ] 1.5 封装常用接口 (日线、财务、龙虎榜)

### 阶段 2: 雪球接入 (Day 2-3)
- [ ] 2.1 实现 HTTP 客户端 (基于调研文档)
- [ ] 2.2 实现 Cookie 管理
- [ ] 2.3 接入行情数据
- [ ] 2.4 接入社区数据 (大V帖子)
- [ ] 2.5 接入组合数据

### 阶段 3: 报告生成 (Day 3-5)
- [ ] 3.1 设计报告模板 (Markdown)
- [ ] 3.2 实现每日报告生成
- [ ] 3.3 实现周报生成
- [ ] 3.4 实现选股报告生成
- [ ] 3.5 配置定时触发 (cron)

### 阶段 4: 自动化与通知 (Day 5-7)
- [ ] 4.1 报告自动保存到指定目录
- [ ] 4.2 通过 Telegram 推送报告摘要
- [ ] 4.3 支持用户交互查询
- [ ] 4.4 错误处理和重试机制

## 技术方案

### 目录结构
```
/Users/apple/openclaw/
├── data/
│   ├── tushare/          # Tushare缓存数据
│   ├── xueqiu/           # 雪球缓存数据
│   └── reports/          # 生成的报告
├── scripts/
│   ├── fetch_tushare.py  # Tushare数据获取
│   ├── fetch_xueqiu.py   # 雪球数据获取
│   └── generate_report.py # 报告生成
```

### 数据缓存策略
- 日线数据: 每日更新，保留1年
- 财务数据: 季度更新，保留3年
- 社区数据: 实时获取，保留7天

## 验收标准

- [ ] Tushare 能获取任意股票日线数据
- [ ] 雪球能获取实时行情和社区帖子
- [ ] 每日报告能自动生成并推送
- [ ] 报告内容准确、格式清晰

## 风险与应对

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| Tushare积分不足 | 部分数据无法获取 | 先用基础数据，后续积累积分 |
| 雪球反爬虫 | 请求被拦截 | 限速+Cookie轮换 |
| 数据延迟 | 报告不及时 | 多源互补 |

## 相关链接

- Tushare官网: https://tushare.pro
- Tushare文档: https://tushare.pro/document/2
- 雪球调研: `TODO/雪球数据接口调研_2026-02-01.md`
- 小市值策略: `ideas/小市值价值选股策略-2026-02-01.md`

---
*创建时间: 2026-02-01*
