# 分时图 VLM 分析模块开发

**任务 ID**: T016
**优先级**: P1
**创建时间**: 2026-02-02 23:00
**状态**: 🔥 开发中 (阶段 2/5)

**目标**: 使用 VLM 视觉理解分析股票分时图

**参考文档**: `docs/PLAN_03_chart_analyzer.md`

---

## 开发清单

### 阶段 1: 数据层 (预计 3 小时) ✅ 完成

- [x] 1.1 修复 star_adapter.py API 兼容性问题 (改用 AkshareClient)
- [x] 1.2 新增 `get_minutely_data()` 方法
- [x] 1.3 测试分时数据获取

### 阶段 2: 图表生成 (预计 3 小时) ✅ 完成

- [x] 2.1 安装 matplotlib 依赖
- [x] 2.2 实现 `generate_minute_chart()` 函数
- [x] 2.3 生成测试图片验证质量 (200KB, 2084x1182)
- [x] 2.4 优化图表样式（清晰可读）

### 阶段 3: VLM 集成 (预计 3 小时) ✅ 完成

- [x] 3.1 配置 Kimi API Key (从环境变量读取)
- [x] 3.2 复用 tech-signal-vlm 的 ChartAnalyzer
- [x] 3.3 编写集成测试 test_minute_chart_vlm.py
- [ ] 3.4 测试单只股票分析 (需要 API Key)

### 阶段 4: 批量处理 (预计 2 小时)

- [ ] 4.1 实现批量分析功能
- [ ] 4.2 输出 Telegram 格式消息
- [ ] 4.3 集成到 daily_reporter

### 阶段 5: 测试优化 (预计 2 小时)

- [ ] 5.1 编写单元测试
- [ ] 5.2 Prompt 优化迭代
- [ ] 5.3 性能优化（并发/缓存）

---

## 依赖

| 依赖 | 状态 | 说明 |
|------|------|------|
| star_adapter.py | 需修复 | API 兼容性问题 |
| Kimi API | 待配置 | 需 API Key |
| matplotlib | 待安装 | 图表生成 |
| openai | 已安装 | Kimi SDK |

---

## 验收标准

- [ ] 能够生成清晰的分时图
- [ ] VLM 正确识别基本形态
- [ ] 单次分析 < 10 秒
- [ ] 接入现有报告流程

---

## 预估工时

**总计: 11 小时**

---

*最后更新: 2026-02-02 23:00*
