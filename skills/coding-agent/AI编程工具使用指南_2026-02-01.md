# AI 编程工具使用指南

**创建日期**: 2026-02-01
**最后更新**: 2026-02-01
**来源**: 整合 opencode-team / claude-team / coding-agent / mcporter skills

---

## 一、工具对比总览

| 工具 | 定位 | 适用场景 | 复杂度 | 依赖 |
|------|------|----------|--------|------|
| **Claude Code** | 主力 AI 程序员 | 复杂架构设计、从 0 到 1 | 中 | Claude CLI |
| **OpenCode** | 轻量级 Worker | 日常小任务、Bug 修复 | 低 | OpenCode CLI + iTerm2 |
| **mcporter** | MCP 工具调用 | 直接调用 MCP server | 低 | mcporter CLI |
| **Claude Team** | 多 Worker 协调 | 并行开发、批量处理 | 高 | mcporter + iTerm2 |
| **OpenCode Team** | 多 Worker 协调 | 并行开发、批量处理 | 高 | iTerm2 |

---

## 二、使用决策树

```
任务来了
    │
    ├── 复杂度高？ ──是──→ Claude Code (opus)
    │       │
    │       └── 否
    │           │
    ├── 需要并行多个？ ──是──→ Claude Team / OpenCode Team
    │       │
    │       └── 否
    │           │
    ├── 纯 MCP 调用？ ──是──→ mcporter call
    │       │
    │       └── 否
    │           │
    └── 小修改/Bug？ ──是──→ OpenCode
```

---

## 三、Claude Code (主力工具)

### 3.1 何时使用

| 场景 | 示例 |
|------|------|
| 新项目初始化 | "Create a Python stock analysis project" |
| 架构设计 | "Design a trading system architecture" |
| 复杂调试 | "Debug why the webhook is failing" |
| 代码审查 | "Review this PR for bugs" |
| 文档编写 | "Write a comprehensive README" |

### 3.2 核心命令

```bash
# 交互模式
claude                           # 当前目录启动
claude "explain this project"    # 带初始 prompt 启动
claude -c                        # 继续上次对话
claude -r "session-name"         # 恢复特定会话

# 头模式 (非交互)
claude -p "query"                # 单次查询，打印结果后退出
claude -p --max-turns 3          # 限制回合数
claude -p --output-format json   # JSON 输出

# 模型切换
claude --model opus              # 复杂任务用 opus
claude --model sonnet            # 简单任务用 sonnet
```

### 3.3 权限模式

- **Default**: 问权限后执行文件修改和命令
- **Auto-accept**: 自由修改文件，需确认命令
- **Plan Mode**: 只读，生成计划后等待确认

切换: `Shift+Tab`

### 3.4 最佳实践

1. **Be Specific**: "Fix auth bug in src/auth/token.ts" > "fix the bug"
2. **Provide Verification**: 包含测试用例或预期输出
3. **Use Plan Mode First**: 复杂变更先用 Plan Mode
4. **Manage Context**: `/clear` 切换无关任务
5. **Reference Files**: `@filepath` 引用特定文件

### 3.5 重要规则

```bash
# ❌ 禁止
cd ~/clawd/ && claude           # 在 OpenClaw 主目录运行
claude                          # 在未初始化的目录运行

# ✅ 正确
cd ~/Projects/myproject && claude
claude "explain this project"   # 非 git 目录用 prompt 先说明
```

---

## 四、OpenCode (轻量级)

### 4.1 何时使用

| 场景 | 示例 |
|------|------|
| Bug 修复 | "Fix the TypeError in utils.py" |
| 小功能迭代 | "Add logging to the API client" |
| 代码优化 | "Refactor this function to use async/await" |
| 单元测试 | "Add unit tests for the calculator" |
| 代码格式化 | "Format this file with black" |

### 4.2 安装

```bash
# 检查是否安装
which opencode

# 安装
npm install -g @opencode-ai/cli
# 或
pnpm add -g @opencode-ai/cli
```

### 4.3 使用方式

**方式 1: 直接运行**
```bash
opencode run "Your task here"
```

**方式 2: iTerm2 集成 (推荐)**
通过 opencode-team skill 管理多个 Worker：

```bash
# 通过 mcporter 调用
mcporter call opencode-team.spawn_workers workers='[{
  "project_path": "/path/to/repo",
  "prompt": "Fix the auth bug",
  "annotation": "Auth bug fix"
}]'
```

### 4.4 特点

- **轻量**: 启动快，资源占用低
- **专注**: 适合单一任务
- **临时**: Worker 完成后可关闭

---

## 五、Claude Team (多 Worker 协调)

### 5.1 何时使用

| 场景 | 示例 |
|------|------|
| 并行开发 | 多个 Feature 同时开发 |
| 批量处理 | 批量 Review PRs |
| 复杂任务分解 | 拆分成多个子任务并行执行 |
| Beads 集成 | 按 Issue 追踪任务 |

### 5.2 核心命令

```bash
# 启动 Worker
mcporter call claude-team.spawn_workers workers='[{
  "project_path": "/path/to/repo",
  "bead": "cp-123",
  "annotation": "Auth module",
  "use_worktree": true,
  "skip_permissions": true
}]'

# 查看 Worker 状态
mcporter call claude-team.list_workers

# 发送消息
mcporter call claude-team.message_workers \
  session_ids='["Groucho"]' \
  message="Also add unit tests"

# 等待完成
mcporter call claude-team.wait_idle_workers \
  session_ids='["Groucho","Harpo"]' \
  mode="all"

# 关闭 Worker
mcporter call claude-team.close_workers session_ids='["Groucho"]'
```

### 5.3 Worker 名称

自动分配: Groucho, Harpo, Chico, Zeppo, Gummo, Aragorn, Gandalf...

### 5.4 工作流程

```bash
# 1. 启动 Worker (自动创建 worktree)
mcporter call claude-team.spawn_workers workers='[{
  "project_path": "auto",
  "bead": "cp-456",
  "annotation": "Implement API"
}]' layout="new"

# 2. 监控进度
mcporter call claude-team.check_idle_workers session_ids='["Groucho"]'
mcporter call claude-team.read_worker_logs session_id="Groucho"

# 3. 完成后合并
mcporter call claude-team.close_workers session_ids='["Groucho"]']
# 然后: git merge 或 cherry-pick
```

### 5.5 Beads 集成

```bash
# Worker 自动：
# 1. 创建 worktree，branch 名 = bead ID
# 2. 运行 `bd show <bead>` 理解任务
# 3. 标记 issue in_progress
# 4. 实现功能
# 5. 关闭 issue
# 6. commit 并引用 issue
```

---

## 六、OpenCode Team (轻量级多 Worker)

### 6.1 与 Claude Team 的区别

| 对比项 | Claude Team | OpenCode Team |
|--------|-------------|---------------|
| 底层工具 | Claude Code | OpenCode CLI |
| 复杂度 | 高 | 中 |
| 功能 | 完整 | 简化版 |
| Beads 集成 | ✅ | ❌ |
| Worktree | ✅ | ✅ |

### 6.2 核心命令

```bash
# 启动 Worker
mcporter call opencode-team.spawn_workers workers='[{
  "project_path": "/path/to/repo",
  "prompt": "Your task",
  "layout": "new"
}]'

# 查看状态
mcporter call opencode-team.list_workers

# 发送消息
mcporter call opencode-team.message_workers \
  session_ids='["Groucho"]' \
  message="Add tests"

# 关闭
mcporter call opencode-team.close_workers session_ids='["Groucho"]']
```

### 6.3 使用场景

- 简单并行任务
- 不需要 Beads 集成
- 需要快速并行验证

---

## 七、mcporter (MCP 直接调用)

### 7.1 何时使用

| 场景 | 示例 |
|------|------|
| MCP Tool 直接调用 | `mcporter call linear.list_issues limit=5` |
| MCP Server 测试 | `mcporter inspect-cli <server-path>` |
| 配置管理 | `mcporter config list` |
| 代码生成 | `mcporter generate-cli --server claude-team` |

### 7.2 核心命令

```bash
# 列出 MCP Server
mcporter list

# 调用工具
mcporter call linear.list_issues team=ENG limit:5
mcporter call "linear.create_issue(title: \"Bug\")"

# Stdio 模式
mcporter call --stdio "bun run ./server.ts" scrape url=https://example.com

# 配置
mcporter config list
mcporter auth <server> --reset

# 代码生成
mcporter emit-ts claude-team --mode types
```

### 7.3 重要参数

| 参数 | 说明 |
|------|------|
| `--config` | 指定配置文件 |
| `--output json` | JSON 格式输出 |
| `--args '{"key":"value"}'` | JSON 参数 |

---

## 八、coding-agent Skill (底层接口)

### 8.1 使用场景

- 直接通过 exec/bash 调用 Claude Code / Codex / OpenCode / Pi
- 需要 PTY 模式 (重要!)
- 背景运行 + 监控

### 8.2 关键规则

```bash
# ✅ 正确 - 使用 PTY
bash pty:true workdir:~/project command:"codex exec 'Your task'"
bash pty:true command:"claude 'Your task'"
bash pty:true command:"opencode run 'Your task'"

# ❌ 错误 - 缺少 PTY，agent 可能挂掉
bash command:"codex exec 'Your task'"
```

### 8.3 背景任务模式

```bash
# 启动 (返回 sessionId)
bash pty:true workdir:~/project background:true command:"codex --yolo 'Build a REST API'"

# 监控
process action:log sessionId:XXX
process action:poll sessionId:XXX

# 发送输入
process action:write sessionId:XXX data:"y"
process action:submit sessionId:XXX data:"yes"

# 终止
process action:kill sessionId:XXX
```

---

## 九、工作流程最佳实践

### 9.1 新项目启动

```bash
# 1. Claude Code 初始化
cd ~/Projects/newproject && claude "Create a Python project with:
- poetry for dependencies
- pytest for tests
- src/ structure
- README.md"

# 2. 验证
cd newproject && pnpm test
```

### 9.2 Bug 修复

```bash
# 1. OpenCode 修复
opencode run "Fix the TypeError in src/api/client.py at line 45"

# 2. 验证
pnpm test
```

### 9.3 并行开发

```bash
# Claude Team 启动多个 Worker
mcporter call claude-team.spawn_workers workers='[
  {"project_path": "auto", "bead": "cp-1", "annotation": "Auth"},
  {"project_path": "auto", "bead": "cp-2", "annotation": "API"},
  {"project_path": "auto", "bead": "cp-3", "annotation": "Tests"}
]' layout="new"

# 等待完成
mcporter call claude-team.wait_idle_workers \
  session_ids='["Groucho","Harpo","Chico"]' mode="all"

# 合并
mcporter call claude-team.close_workers \
  session_ids='["Groucho","Harpo","Chico"]'
```

### 9.4 PR Review

```bash
# 克隆到临时目录 (安全)
REVIEW_DIR=$(mktemp -d)
git clone https://github.com/user/repo.git $REVIEW_DIR
cd $REVIEW_DIR && gh pr checkout 130

# Claude Code Review
bash pty:true workdir:$REVIEW_DIR command:"codex review --base origin/main"

# 清理
rm -rf $REVIEW_DIR
```

---

## 十、常见问题

### Q1: Claude Code 和 OpenCode 选哪个？

| 问题 | 答案 |
|------|------|
| 复杂架构设计 | Claude Code |
| 从 0 到 1 新项目 | Claude Code |
| 需要深度理解代码库 | Claude Code |
| 快速 Bug 修复 | OpenCode |
| 简单代码修改 | OpenCode |

### Q2: Claude Team 和 OpenCode Team 选哪个？

| 问题 | 答案 |
|------|------|
| 需要 Beads 集成 | Claude Team |
| 复杂并行任务 | Claude Team |
| 简单并行 | OpenCode Team |
| 资源有限 | OpenCode Team |

### Q3: 为什么 agent 挂掉了？

常见原因：
1. **缺少 PTY** - 一定要用 `pty:true`
2. **不在 git 目录** - Codex 拒绝运行
3. **超时** - 设置合理 timeout
4. **权限问题** - 用 `skip_permissions: true`

### Q4: 如何选择模型？

```bash
# 复杂任务
claude --model opus

# 简单任务
claude --model sonnet

# OpenCode (内置 MiniMax)
opencode run "Your task"
```

---

## 十一、命令速查表

### Claude Code
```bash
claude "task"              # 交互模式
claude -p "task"           # 头模式
claude --model opus        # 切换模型
claude --verbose           # 详细输出
```

### OpenCode
```bash
opencode run "task"        # 执行任务
```

### Claude Team
```bash
mcporter call claude-team.spawn_workers ...
mcporter call claude-team.list_workers
mcporter call claude-team.close_workers ...
```

### OpenCode Team
```bash
mcporter call opencode-team.spawn_workers ...
mcporter call opencode-team.list_workers
mcporter call opencode-team.close_workers ...
```

### mcporter
```bash
mcporter list                          # 列出 server
mcporter call server.tool key=value    # 调用工具
mcporter config list                   # 配置
mcporter emit-ts server --mode types   # 生成类型
```

---

## 十二、重要规则 (必须遵守)

### 12.1 安全边界

```bash
# ❌ 禁止
cd ~/clawd/ && claude           # 在 OpenClaw 主目录运行
cd ~/Projects/openclaw && claude  # 在 Live OpenClaw 运行
git checkout <branch> in main    # 直接在主分支 checkout

# ✅ 正确
cd ~/Projects/newproject && claude
git worktree add /tmp/branch branch
```

### 12.2 权限控制

```bash
# Claude Team Worker 需要
skip_permissions: true

# Claude Code
claude --dangerously-skip-permissions  # 慎用!
```

### 12.3 版本控制

```bash
# 改配置前
git add -A && git commit -m "config: backup before change"

# 出问题后
git revert <commit-hash>
```

---

## 十三、相关资源

| 资源 | 链接 |
|------|------|
| Claude Code Docs | https://code.claude.com/docs/en/overview |
| Claude CLI Reference | https://code.claude.com/docs/en/cli-reference |
| mcporter | http://mcporter.dev |
| OpenCode Team | skills/opencode-team/SKILL.md |
| Claude Team | skills/claude-team/SKILL.md |

---

*最后更新: 2026-02-01*
*整合自多个 skill 文档*
