# OpenClaw 运维经验与改进建议

**来源**: 小红书用户分享 (188176657)
**日期**: 2026-02-01
**类型**: 运维经验 / 系统优化

---

## 一、核心痛点分析

### 1.1 上下文过载问题
- **现象**: 模型 context 超过 80% 后响应速度急剧下降
- **影响**: 长对话场景下用户体验极差
- **根本原因**: 缺乏有效的上下文压缩和记忆分层机制

### 1.2 记忆清空问题
- **现象**: context 清除或刷新后，模型"失忆"
- **影响**: 调试重要的 Skill 时丢失关键上下文
- **教训**: 对话框是临时的，文件记录才是资产

### 1.3 幻觉问题
- **现象**: 声称有"结构化记忆"，实际效果远不如预期
- **影响**: 信任度下降，需要额外验证
- **结论**: 主动写入的文件 > 依赖自动记忆

---

## 二、解决方案

### 2.1 烂笔头原则 (核心原则)

> "AI 时代，飘在空中的对话没有价值，沉淀下来的记录才是资产。"

**行动项**:
- ✅ 重要对话必须及时写入文件
- ❌ 不要过度依赖临时对话框的记忆
- 📝 人工记录的价值 > 模型自动记忆

**具体执行**:
```
每次重要决策/对话 → 立即写入 memory/ 或相关文档
而不是等待 context 自动保存
```

### 2.2 手动维护机制

**Skill 逻辑核心要点**:
- 必须手动存储在独立文档
- 需要时作为 context 喂给模型
- 避免依赖自动生成的记忆

**实施方法**:
```markdown
# Skill 核心逻辑文档结构
## 1. 功能概述
## 2. 核心参数
## 3. 边界条件
## 4. 已知问题
## 5. 改进历史
```

### 2.3 网络配置 (大陆用户特供)

**问题描述**:
```
❌ 配置 http_proxy 环境变量 ≠ 全面代理
❌ Node.js 内部进程可能不走代理
❌ 调试 OpenAI/Gemini 时网络超时
```

**解决方案**:
```json5
{
  "providers": {
    "openai": {
      "httpProxy": "http://host:port",  // 底层强制指定
    },
    "google": {
      "httpProxy": "http://host:port",
    }
  }
}
```

**检查清单**:
- [ ] 确认每一个调用模型的节点都走代理
- [ ] 在 Config 中强制指定网络出口
- [ ] 避免"假代理"（终端代理 ≠ 进程代理）

---

## 三、系统稳定性方案

### 3.1 外部监控系统

**架构设计**:
```
主力电脑 IDE
    ↓ 监控
OpenClaw Gateway
    ↓ 检测
发现问题 → 自动修复/重启
```

**功能**:
- 实时状态监控
- 异常自动检测
- 自动修复/升级
- 重启 Gateway

### 3.2 心跳检测机制

**实现方式**:
```bash
# 每 5 分钟戳一下 AI
*/5 * * * * curl -s http://localhost:18789/health || openclaw gateway restart
```

**阈值设置**:
- 检测频率: 5 分钟
- 死亡判定: 连续 2 次无响应
- 恢复动作: 强制重启 Gateway

### 3.3 Systemd 替代 pm2

**原因**:
| 方案 | 优点 | 缺点 |
|------|------|------|
| pm2 | 调试方便 | 可能陷入自杀循环 |
| Systemd | 系统级稳定 | 重启需要 root |

**配置示例**:
```ini
# /etc/systemd/system/openclaw-gateway.service
[Unit]
Description=OpenClaw Gateway Service
After=network.target

[Service]
Type=simple
User=apple
WorkingDirectory=/Users/apple/openclaw
ExecStart=/usr/local/bin/openclaw gateway run --bind 0.0.0.0 --port 18789
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**启用命令**:
```bash
sudo cp openclaw-gateway.service /etc/systemd/system/
sudo systemctl enable openclaw-gateway
sudo systemctl start openclaw-gateway
```

---

## 四、版本控制铁律

> "修改配置前，一定要做一个回滚备份！用 Git 管理配置。每次改 JSON 前先 Commit。靠这个习惯，我救回了 15 次崩溃。"

### 4.1 核心原则
- ✅ 每次改配置前先 Commit
- ✅ 回滚能力 = 系统基本生存能力
- ✅ 没有回滚能力的系统 = 一次性系统

### 4.2 实施方法
```bash
# 改配置前
git add -A && git commit -m "config: backup before XXX change"

# 出问题后
git log --oneline -5
git revert <commit-hash>
```

---

## 五、对我的迭代改进

### 5.1 记忆机制改进

**当前问题**:
- 依赖 context 自动保存
- 没有主动写入文件的习惯
- Skill 逻辑缺乏手动维护

**改进措施**:
| 现状 | 改进后 |
|------|--------|
| 被动记忆 | 主动写入重要决策 |
| 对话框存储 | 文件持久化 |
| 自动记忆 | 手动 + 自动双保险 |

**具体行动**:
1. 每次重要对话 → 立即写入 memory
2. Skill 核心逻辑 → 手动维护文档
3. 避免过度依赖 context

### 5.2 网络配置检查

**待办**:
- [ ] 检查 OpenClaw 底层网络配置
- [ ] 确认所有模型调用走代理
- [ ] 测试 Gemini/OpenAI 连通性

### 5.3 系统稳定性提升

**优先级**:
1. **高**: 配置 Systemd 服务 (防止自杀循环)
2. **中**: 添加心跳检测脚本
3. **低**: 建立外部监控系统

### 5.4 版本控制习惯

**行动项**:
- [ ] 养成"改配置前先 Commit"习惯
- [ ] 所有配置变更走 Git
- [ ] 保留回滚能力

---

## 六、待确认事项

1. **Systemd 权限**: 是否有 root 权限配置系统服务？
2. **代理配置**: 当前网络环境能否访问 OpenAI/Gemini？
3. **监控需求**: 是否需要完整的外部监控系统？

---

## 七、相关链接

- 来源: 小红书 188176657
- 日期: 2026-02-01
- 相关项目: OpenClaw Gateway

---

*最后更新: 2026-02-01*
*来源: 用户分享的运维经验*
