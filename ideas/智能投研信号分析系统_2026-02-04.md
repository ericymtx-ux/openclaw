# 智能投研信号分析系统

**创建日期**: 2026-02-04
**最后更新**: 2026-02-04
**状态**: 待开发
**优先级**: P1

---

## 核心定位

基于邮件信号的**智能投研分析系统**，整合热度排名、信号验证、板块联动、胜率追踪，辅助人工决策。

**数据源**：
- 📧 邮件信号：人气与趋势邮件（热度排名、买卖信号）
- 📊 历史收益：邮件信号触发后的 N 日涨跌幅
- 🏢 板块信息：手动标注 + 自动推断

---

## 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                    智能投研信号分析系统                       │
├─────────────────────────────────────────────────────────────┤
│  数据层                                                      │
│  ├── 邮件信号解析器 (热度排名 + 买卖标记)                     │
│  ├── 历史收益追踪 (信号触发后的 N 日表现)                     │
│  └── 板块/产业链映射 (手动标注 + 自动推断)                    │
├─────────────────────────────────────────────────────────────┤
│  分析层                                                      │
│  ├── 信号有效性评估 (命中率、盈亏比)                         │
│  ├── 情绪温度计 (热度集中度 vs 市场热度)                     │
│  ├── 证伪识别 (利好→高开低走的预警)                          │
│  └── 板块联动检测 (同板块多票共振)                           │
├─────────────────────────────────────────────────────────────┤
│  输出层                                                      │
│  ├── 每日信号报告 (精选 10 只，按热度排序)                   │
│  ├── 胜率统计 (按行业/信号类型/月度)                         │
│  └── 风险预警 (证伪信号 + 板块过热)                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 核心功能模块

### 模块 1: 信号解析与结构化

**输入**: 邮件 HTML 表格
**输出**: 结构化信号列表

```python
{
    "code": "000547.SZ",
    "name": "航天发展",
    "action": "持",           # 开/持/平
    "price": 34.05,
    "change": "+5.16%",
    "heat_rank": 2,           # 热度排名
    "heat_value": 9853086,    # 热度值
    "volume_relation": "量缩价涨",
    "net_amount": "-8.98亿",  # 大单净额
    "date": "2026-02-04",
    "source": "人气与趋势-2026-02-04 10"
}
```

### 模块 2: 胜率追踪系统

**功能**:
- 记录每次信号触发后的 N 日涨跌幅
- 按月/行业/信号类型统计胜率
- 可视化趋势图表

**统计维度**:
| 维度 | 说明 |
|------|------|
| 命中率 | 买入信号后 N 日涨 > 0 的比例 |
| 盈亏比 | 平均盈利 / 平均亏损 |
| 最佳信号 | 某类信号的胜率排名 |
| 最差信号 | 需要规避的信号类型 |

**数据表结构**:
```sql
CREATE TABLE signal_tracking (
    id INTEGER PRIMARY KEY,
    code TEXT,
    name TEXT,
    action TEXT,           -- 开/持/平
    signal_date DATE,
    heat_rank INTEGER,
    price_at_signal REAL,
    price_n1 REAL,         -- 1日后价格
    price_n3 REAL,         -- 3日后价格
    price_n5 REAL,         -- 5日后价格
    price_n10 REAL,        -- 10日后价格
    industry TEXT,         -- 行业板块
    verification TEXT      -- 待验证/证伪/确认
);
```

### 模块 3: 情绪温度计

**公式**:
```
情绪指数 = (Top10 热度集中度) × (持仓信号占比) / (市场平均热度)
```

**解读**:
- 情绪指数 > 1.5: 市场过热，警惕回调
- 情绪指数 < 0.5: 市场低迷，可能迎来反弹
- 情绪指数 0.8-1.2: 正常区间

**热度集中度**:
```python
# Top10 热度占比
top10_heat = sum(top10_heat_values) / sum(all_heat_values)
```

### 模块 4: 证伪识别器

**检测逻辑**:
| 信号 | 预期走势 | 证伪条件 |
|------|----------|----------|
| 🔴开 (买入) | 高开高走 / 震荡上行 | 高开低走收盘跌 > 2% |
| 🟡持 (持有) | 震荡整理或上行 | 跌破 5 日线且无反弹 |
| ⚪空 (观望) | 低开低走 | 低开高走收盘涨 > 3% |

**预警输出**:
```markdown
⚠️ 证伪预警: [股票名称]
- 信号: 🔴开 (买入)
- 发布日期: 2026-02-04
- 预期: 高开高走
- 实际: 高开低走，收盘 -3.2%
- 结论: 逻辑被证伪，建议止损
```

### 模块 5: 板块联动检测

**触发条件**:
```python
# 同板块 N 只以上同时出现信号
if same_industry_count >= 3:
    trigger_block_rally_warning()
```

**输出**:
```markdown
🚀 板块联动预警: [板块名称]
- 信号股票: [股票1] 🔴开, [股票2] 🔴开, [股票3] 🔴开
- 热度排名: [2, 5, 6]
- 建议: 板块可能迎来短期炒作，关注板块ETF
```

---

## 数据流设计

```
邮件解析 → 信号提取 → 历史匹配 → 胜率计算 → 情绪评估 → 报告生成
   ↓           ↓           ↓           ↓           ↓           ↓
HTML表格    结构化数据    关联历史     统计指标     指数计算     Markdown
```

**关键数据流**:
1. 每日邮件解析 → 更新信号追踪表
2. 定期回溯 → 填充历史收益数据
3. 每周统计 → 更新胜率报表

---

## 实施计划

### Phase 1: 基础框架 (1周)

- [ ] 信号解析器重构 (支持热度排名)
- [ ] 创建 signal_tracking 表
- [ ] 每日信号自动入库

### Phase 2: 胜率系统 (1周)

- [ ] 历史收益回填脚本
- [ ] 胜率统计 API
- [ ] 可视化图表

### Phase 3: 高级分析 (2周)

- [ ] 情绪温度计公式实现
- [ ] 证伪识别器
- [ ] 板块联动检测
- [ ] 综合报告生成器

---

## 依赖与约束

### 依赖
- Python 3.10+
- SQLite (数据存储)
- himalaya (邮件读取)
- matplotlib (图表)

### 约束
- 不依赖外部 API (雪球/东方财富 已被封)
- 数据源: 邮件信号 + 手动标注
- 增量更新，不做全量回溯

---

## 相关文件

- 原始方法论: `ideas/选股炒股思路-见微知著与逻辑博弈_2026-02-01.md`
- 邮件监控: `agents/email_checker/stock_email_checker.py`
- 知识库: `memory/` (历史对话记录)

---

## 预期产出

1. **每日信号报告** (Markdown): `data/reports/daily_signal_YYYYMMDD.md`
2. **胜率统计** (SQLite): `data/signal_tracking.db`
3. **情绪指数** (JSON): `data/emotion_index.json`
4. **证伪预警** (实时): Telegram 推送

---

*最后更新: 2026-02-04*
